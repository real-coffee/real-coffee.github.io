<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ë¸”ë¡ ì•„íŠ¸ ìƒì„±ê¸° (ë¬¸ì â†’ ã…/ì´ëª¨ì§€/ì„ì˜ë¬¸ì) â€“ ë©”ì‹ ì € í­ íŠœë‹</title>
  <style>
    :root { --bg:#f7f7fb; --card:#ffffff; --ink:#111827; --muted:#6b7280; --brand:#4f46e5; }
    *{box-sizing:border-box}
    body{margin:0; font-family: system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans KR","Apple SD Gothic Neo","Malgun Gothic",Arial,sans-serif; background:var(--bg); color:var(--ink)}
    .wrap{max-width:1024px; margin:0 auto; padding:24px}
    .card{background:var(--card); border-radius:16px; box-shadow:0 10px 30px rgba(0,0,0,.06); padding:16px}
    h1{font-size:clamp(20px,3vw,28px); margin:0 0 8px}
    p.small{color:var(--muted); margin:0 0 16px; font-size:13px}
    .grid{display:grid; gap:12px; grid-template-columns:1fr}
    @media (min-width:768px){ .grid-3{ grid-template-columns:repeat(3,1fr)} }
    .row{display:grid; gap:6px}
    label{font-size:13px; color:var(--muted)}
    input[type="text"], input[type="number"], button, select{height:40px}
    input[type="text"], input[type="number"], select{width:100%; border:1px solid #e5e7eb; border-radius:10px; padding:0 12px; background:#fff; outline:none; transition: box-shadow .15s,border-color .15s}
    input[type="text"]:focus, input[type="number"]:focus, select:focus{border-color:var(--brand); box-shadow:0 0 0 3px rgba(79,70,229,.15)}
    input[type="range"]{width:100%}
    .controls{display:flex; flex-wrap:wrap; gap:8px; align-items:center}
    .btn{border:0; background:var(--brand); color:#fff; border-radius:10px; padding:0 12px; cursor:pointer}
    .btn:hover{filter:brightness(.95)}
    .btn-ghost{background:#eef2ff; color:#3730a3}
    .mono{white-space:pre; overflow:auto; background:#0b1020; color:#e5e7eb; border-radius:12px; padding:12px; line-height:1em; font-family: ui-monospace,Menlo,Monaco,Consolas,'Liberation Mono','Courier New',monospace}
    .hint{font-size:12px; color:var(--muted)}
    .row-inline{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .switch{display:inline-flex; gap:6px; align-items:center; font-size:13px}
    .footer{color:var(--muted); font-size:12px; margin-top:8px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="row-inline" style="justify-content:space-between;">
        <h1>ë¸”ë¡ ì•„íŠ¸ ìƒì„±ê¸° â€“ ë©”ì‹ ì €ìš© í­/ì—¬ë°± ì œì–´</h1>
        <div class="controls">
          <button class="btn btn-ghost" id="presetPc" title="PC í•´ìƒë„ í”„ë¦¬ì…‹">PC(64)</button>
          <button class="btn btn-ghost" id="presetMo" title="ëª¨ë°”ì¼ í•´ìƒë„ í”„ë¦¬ì…‹">Mobile(20)</button>
        </div>
      </div>
      <p class="small">ì´ ë„êµ¬ëŠ” ì…ë ¥ í…ìŠ¤íŠ¸ë¥¼ ìº”ë²„ìŠ¤ì— ë Œë”ë§í•´ ìƒ˜í”Œë§í•œ ë’¤, ê° ì…€ì„ <b>ì‚¬ìš©ì ì§€ì • í­</b>ì˜ ë¬¸ìì—´ë¡œ ì¹˜í™˜í•´ ì¤ë‹ˆë‹¤. ë©”ì‹ ì €ì—ì„œ íŠ¹ì • ì´ëª¨ì§€/ë¬¸ìê°€ ì•½ <b>Nì¹¸</b>ì„ ì°¨ì§€í•˜ë„ë¡ ë³´ì´ê²Œ í•˜ë ¤ë©´ ì•„ë˜ì˜ <b>ì…€ í­(ì¹¸)</b>ê³¼ <b>ê°€ì • ë¬¸ì í­(ì¹¸)</b>ì„ ì¡°ì •í•˜ì„¸ìš”.</p>

      <div class="grid grid-3">
        <div class="row">
          <label>í…ìŠ¤íŠ¸</label>
          <input type="text" id="text" placeholder="ì˜ˆ: ë”° / Hello / ì•ˆë…• ğŸ˜€" value="ë”°" />
          <div class="hint">ë‘˜ ì´ìƒ ê¸€ìëŠ” í•´ìƒë„(ê°€ë¡œ ë¸”ë¡ ìˆ˜)ë¥¼ ì˜¬ë¦¬ë©´ ìœ¤ê³½ì´ ì¢‹ì•„ì§‘ë‹ˆë‹¤.</div>
        </div>
        <div class="row">
          <label>ê°€ë¡œ ë¸”ë¡ ìˆ˜: <span id="colsVal">64</span></label>
          <input type="range" id="cols" min="8" max="160" value="64" />
          <div class="hint">ëª¨ë°”ì¼ 8â€“24 ê¶Œì¥. í™”ë©´ì´ ì¢ì„ìˆ˜ë¡ ë‚®ì¶”ì„¸ìš”.</div>
        </div>
        <div class="row">
          <label>ê°ë„(ì„ê³„ê°’): <span id="thVal">140</span></label>
          <input type="range" id="th" min="40" max="220" value="140" />
          <div class="hint">ë‚®ì„ìˆ˜ë¡ ë” ì§„í•˜ê²Œ ì±„ì›Œì§‘ë‹ˆë‹¤.</div>
        </div>
      </div>

      <div class="grid" style="grid-template-columns:1fr 1fr;">
        <div class="row">
          <label>ì±„ì›Œì§„ ì…€(ì „ê²½) ë¬¸ì</label>
          <input type="text" id="fg" value=":coffee:" />
          <div class="hint">ì˜ˆ: ã…, â–ˆ, â—, ğŸ˜€, â˜•, ë˜ëŠ” <code>:coffee:</code> ì²˜ëŸ¼ ë‹¨ì¶•ì–´. (ì¼ë¶€ ì§€ì›)</div>
        </div>
        <div class="row">
          <label>ë¹ˆ ì…€(ë°°ê²½) ë¬¸ì</label>
          <input type="text" id="bg" value="ã€€" />
          <div class="hint">ì „ê° ê³µë°±(U+3000) ê¸°ë³¸ â€“ í­ ì •ë ¬ì— ìœ ë¦¬</div>
        </div>
      </div>

      <div class="grid" style="grid-template-columns:1fr 1fr 1fr;">
        <div class="row">
          <label>ì…€ í­(ì¹¸)</label>
          <input type="number" id="cellCols" min="1" max="20" value="6" />
          <div class="hint">ë©”ì‹ ì €ì—ì„œ í•œ ì…€ì´ ì°¨ì§€í•˜ê¸¸ ì›í•˜ëŠ” ì´ ì¹¸ ìˆ˜ (ì˜ˆ: 6)</div>
        </div>
        <div class="row">
          <label>ê°€ì • ë¬¸ì í­(ì¹¸)</label>
          <input type="number" id="glyphCols" min="0" max="20" value="2" />
          <div class="hint">ì±„ì›Œì§„ ì…€ì— ì“¸ ë¬¸ì/ì´ëª¨ì§€ê°€ ì‹¤ì œë¡œ ì°¨ì§€í•˜ëŠ” ì¹¸ ìˆ˜ ê°€ì •ì¹˜ (ì˜ˆ: ğŸ˜€â‰ˆ2)</div>
        </div>
        <div class="row">
          <label>ì„¸ë¡œ ë°˜ë³µ(ì¤„)</label>
          <input type="number" id="cellRows" min="1" max="4" value="1" />
          <div class="hint">í•œ ì…€ì„ ì„¸ë¡œë¡œ ëª‡ ì¤„ë¡œ ëŠ˜ë ¤ ë³´ì¼ì§€ (ë©”ì‹ ì € ì¢…íš¡ë¹„ ë³´ì •)</div>
        </div>
      </div>

      <div class="grid" style="grid-template-columns:1fr 1fr;">
        <div class="row">
          <label>ì¢Œ/ìš° ë˜í¼(ì„ íƒ)</label>
          <div class="row-inline">
            <input type="text" id="wrapL" value="[" style="width:80px" />
            <span>â€¦ ë‚´ìš© â€¦</span>
            <input type="text" id="wrapR" value="]" style="width:80px" />
          </div>
          <div class="hint">ì˜ˆ: <code>[   ]</code> ëª¨ì–‘ì„ ì›í•˜ë©´ ì…€ í­ì„ 6, ê°€ì • ë¬¸ì í­ì„ 0ìœ¼ë¡œ ë‘ê³  ë˜í¼ë¥¼ [ / ] ë¡œ ì„¤ì •</div>
        </div>
        <div class="row">
          <label class="switch"><input type="checkbox" id="bold" checked> êµµê²Œ(bold, ë Œë”ë§ìš©)</label>
          <label class="switch">ì¤„ ê°„ê²©(ë¹ˆ ì¤„): <input type="number" id="linespace" min="0" max="3" value="0" style="width:64px"></label>
          <label class="switch">í°íŠ¸:
            <select id="fontSel">
              <option value="Apple SD Gothic Neo,Malgun Gothic,Noto Sans KR,Arial Unicode MS,sans-serif">í•œê¸€ ê°€ë…ì„±</option>
              <option value="Noto Sans KR,Apple SD Gothic Neo,Malgun Gothic,Arial Unicode MS,sans-serif">Noto Sans KR</option>
              <option value="Segoe UI,Roboto,system-ui,sans-serif">ì˜ë¬¸ ìœ„ì£¼</option>
              <option value="ui-monospace,Menlo,Monaco,Consolas,'Liberation Mono','Courier New',monospace">Monospace</option>
            </select>
          </label>
        </div>
      </div>

      <div class="controls" style="margin:8px 0; gap:12px;">
        <button class="btn" id="copyBtn">ê²°ê³¼ ë³µì‚¬</button>
        <button class="btn" id="downloadBtn">.txt ì €ì¥</button>
      </div>

      <div class="row">
        <label>ê²°ê³¼</label>
        <pre id="out" class="mono" style="min-height:160px;">(ì—¬ê¸°ì— ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤)</pre>
      </div>

      <canvas id="hiddenCanvas" width="1" height="1" style="display:none"></canvas>
      <div class="footer">ì°¸ê³ : ë©”ì‹ ì €ë§ˆë‹¤ ì´ëª¨ì§€ ê°€ë¡œí­ì´ ë‹¤ë¦…ë‹ˆë‹¤. ìœ„ì˜ <b>ê°€ì • ë¬¸ì í­</b>ì„ ì¡°ì ˆí•´ ì‹¤ì œ ë³´ì´ëŠ” ê²ƒì— ë§ì¶°ë³´ì„¸ìš”. í‹€ì–´ì§€ë©´ Monospace ë¬¸ì(ã…/â–ˆ ë“±)ë¥¼ ì¨ë³´ì„¸ìš”.</div>
    </div>
  </div>

  <script>
    // ê°„ë‹¨í•œ :emoji: ë‹¨ì¶•ì–´ ë§¤í•‘ (í•„ìš” ì‹œ í™•ì¥)
    const EMOJI_MAP = {":coffee:":"â˜•", ":fire:":"ğŸ”¥", ":star:":"â­", ":sparkles:":"âœ¨", ":heart:":"â¤ï¸", ":thumbsup:":"ğŸ‘", ":clap:":"ğŸ‘", ":check:":"âœ…", ":x:":"âŒ", ":smile:":"ğŸ˜„", ":lol:":"ğŸ˜‚", ":rocket:":"ğŸš€"};
    const resolveEmojiShortcodes = s => s.replace(/:[a-z0-9_+-]+:/gi, m => EMOJI_MAP[m.toLowerCase()] || m);

    function firstGrapheme(str, fallback = "ã…"){
      if(!str) return fallback;
      const s = resolveEmojiShortcodes(str.trim());
      if (typeof Intl !== 'undefined' && Intl.Segmenter){
        const seg = new Intl.Segmenter('ko', {granularity:'grapheme'});
        const it = seg.segment(s)[Symbol.iterator]();
        const {value} = it.next();
        return value ? value.segment : fallback;
      }
      return s.codePointAt ? String.fromCodePoint(s.codePointAt(0)) : (s[0]||fallback);
    }

    const $ = sel => document.querySelector(sel);
    const text = $('#text');
    const cols = $('#cols');
    const colsVal = $('#colsVal');
    const th = $('#th');
    const thVal = $('#thVal');
    const fg = $('#fg');
    const bg = $('#bg');
    const bold = $('#bold');
    const linespace = $('#linespace');
    const out = $('#out');
    const fontSel = $('#fontSel');
    const canvas = $('#hiddenCanvas');
    const presetPc = $('#presetPc');
    const presetMo = $('#presetMo');
    const copyBtn = $('#copyBtn');
    const downloadBtn = $('#downloadBtn');

    const cellCols = $('#cellCols');
    const glyphCols = $('#glyphCols');
    const cellRows = $('#cellRows');
    const wrapL = $('#wrapL');
    const wrapR = $('#wrapR');

    // ì´ˆê¸°ê°’: ëª¨ë°”ì¼ì´ë©´ 20, PCë©´ 64
    if (window.innerWidth < 640) cols.value = 20;
    colsVal.textContent = cols.value;
    thVal.textContent = th.value;

    function buildCell(isFilled){
      const total = Math.max(1, parseInt(cellCols.value||'6', 10));
      const assumed = Math.max(0, parseInt(glyphCols.value||'2', 10));
      const L = wrapL.value || '';
      const R = wrapR.value || '';
      const core = isFilled ? firstGrapheme(fg.value, 'ã…') : '';
      const coreAssumed = isFilled ? assumed : 0;
      const innerSpaces = Math.max(0, total - coreAssumed - L.length - R.length);
      return L + (core || '') + ' '.repeat(innerSpaces) + R;
    }

    function buildEmptyCell(){
      return buildCell(false);
    }

    function render(){
      const ctx = canvas.getContext('2d', { willReadFrequently:true });
      const txt = text.value || '';
      const threshold = parseInt(th.value, 10) || 140;
      const weight = bold.checked ? 800 : 400;
      const font = fontSel.value;

      if (!txt.trim()) { out.textContent = ''; return; }

      // ìº”ë²„ìŠ¤ ë Œë”ë§ (ìœ¤ê³½ ì¶”ì¶œ ì „ìš©)
      const baseFontSize = 240;
      ctx.font = `${weight} ${baseFontSize}px ${font}`;
      const metrics = ctx.measureText(txt);
      const textWidth = Math.ceil(metrics.width) + 40;
      const ascent = Math.ceil(metrics.actualBoundingBoxAscent || baseFontSize*0.8);
      const descent = Math.ceil(metrics.actualBoundingBoxDescent || baseFontSize*0.2);
      const textHeight = ascent + descent + 40;

      canvas.width = Math.max(1, textWidth);
      canvas.height = Math.max(1, textHeight);
      ctx.fillStyle = '#ffffff';
      ctx.fillRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle = '#000000';
      ctx.textBaseline = 'alphabetic';
      ctx.font = `${weight} ${baseFontSize}px ${font}`;
      ctx.fillText(txt, 20, 20+ascent);

      const COLS = Math.max(1, parseInt(cols.value,10) || 64);
      const ROWS = Math.max(1, Math.round((canvas.height/canvas.width) * COLS));

      const img = ctx.getImageData(0,0,canvas.width,canvas.height).data;
      const cellW = canvas.width / COLS;
      const cellH = canvas.height / ROWS;

      const filledCell = buildCell(true);
      const emptyCell = buildEmptyCell();

      const lines = [];
      for (let r=0; r<ROWS; r++){
        let line = '';
        for (let c=0; c<COLS; c++){
          const x0 = Math.floor(c*cellW);
          const y0 = Math.floor(r*cellH);
          const x1 = Math.min(canvas.width, Math.floor((c+1)*cellW));
          const y1 = Math.min(canvas.height, Math.floor((r+1)*cellH));
          let sum=0, cnt=0;
          for (let y=y0; y<y1; y++){
            for (let x=x0; x<x1; x++){
              const idx = (y*canvas.width + x)*4;
              const lum = (img[idx]+img[idx+1]+img[idx+2])/3;
              sum += lum; cnt++;
            }
          }
          const avg = cnt ? sum/cnt : 255;
          line += (avg < threshold) ? filledCell : emptyCell;
        }
        const vr = Math.max(1, Math.min(4, parseInt(cellRows.value||'1',10)));
        for (let k=0; k<vr; k++) lines.push(line);
        const extra = Math.max(0, Math.min(3, parseInt(linespace.value||'0',10)));
        for (let k=0; k<extra; k++) lines.push('');
      }
      while (lines.length && lines[0].trim().length===0) lines.shift();
      while (lines.length && lines[lines.length-1].trim().length===0) lines.pop();

      out.textContent = lines.join('\n');
      colsVal.textContent = COLS;
      thVal.textContent = threshold;
    }

    [text, cols, th, fg, bg, bold, linespace, fontSel, cellCols, glyphCols, cellRows, wrapL, wrapR].forEach(el => el.addEventListener('input', render));

    window.addEventListener('resize', () => {});
    presetPc.addEventListener('click', () => { cols.value = 64; render(); });
    presetMo.addEventListener('click', () => { cols.value = 20; render(); });

    copyBtn.addEventListener('click', async () => {
      try { await navigator.clipboard.writeText(out.textContent || ''); } catch(e) { alert('í´ë¦½ë³´ë“œ ë³µì‚¬ ì‹¤íŒ¨: '+e); }
    });
    downloadBtn.addEventListener('click', () => {
      const blob = new Blob([out.textContent||''], {type:'text/plain;charset=utf-8'});
      const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'block-art.txt';
      document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(a.href);
    });

    // ì´ˆê¸° ë Œë”
    render();
  </script>
</body>
</html>
